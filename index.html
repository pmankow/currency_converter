<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Currency Converter</title>
  <meta name="description" content="Fast, no‑key currency converter with a 30‑day trend chart." />
  <link rel="preconnect" href="https://api.frankfurter.app" crossorigin>
  <style>
    :root {
      --bg: #0b0f14; --panel: #111826; --accent: #4f46e5; --text: #e5e7eb; --muted:#9ca3af; --ring:#60a5fa;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif; background: linear-gradient(180deg,#0b0f14,#0f172a); color: var(--text); }
    .wrap { max-width: 920px; margin: 48px auto; padding: 0 16px; }
    .card { background: var(--panel); border: 1px solid rgba(255,255,255,.06); border-radius: 18px; padding: 22px; box-shadow: 0 10px 30px rgba(0,0,0,.35); }
    h1 { margin: 0 0 8px; font-size: clamp(22px, 2.6vw, 34px); letter-spacing: .2px; }
    .muted { color: var(--muted); font-size: 14px; }
    .grid { display: grid; gap: 14px; grid-template-columns: 1fr; margin: 18px 0 10px; }
    @media (min-width: 720px) { .grid { grid-template-columns: 1.2fr .8fr .8fr auto; align-items: end; } }
    label { font-size: 12px; color: var(--muted); display: block; margin: 2px 0 6px; }
    input, select, button { width: 100%; padding: 12px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,.08); background: #0e1624; color: var(--text); outline: none; }
    input:focus, select:focus { border-color: var(--ring); box-shadow: 0 0 0 3px rgba(96,165,250,.25); }
    button { cursor: pointer; background: var(--accent); border: none; font-weight: 600; letter-spacing: .2px; }
    button:disabled { opacity: .6; cursor: not-allowed; }
    .row { display: grid; grid-template-columns: 1fr auto 1fr; gap: 8px; align-items: center; }
    .swap { width: 42px; height: 42px; border-radius: 50%; background: #0e1624; border: 1px solid rgba(255,255,255,.08); display: grid; place-items: center; cursor: pointer; }
    .swap:hover { border-color: var(--accent); }
    .result { margin-top: 14px; font-size: clamp(18px, 2vw, 22px); font-variant-numeric: tabular-nums; }
    .err { color: #fecaca; font-size: 13px; margin-top: 8px; display:none; }
    canvas { background: #0d1523; border-radius: 12px; border: 1px solid rgba(255,255,255,.06); padding: 6px; }
    .footer { margin-top: 18px; font-size: 12px; color: var(--muted); display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    a { color: #93c5fd; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Currency Converter</h1>
      <div class="muted">Live rates via the Frankfurter API (ECB data). No API key needed.</div>

      <div class="grid" id="form">
        <div>
          <label for="amount">Amount</label>
          <input id="amount" type="number" min="0" step="0.01" placeholder="100.00" value="100" />
        </div>
        <div>
          <label for="from">From</label>
          <select id="from"></select>
        </div>
        <div>
          <label for="to">To</label>
          <select id="to"></select>
        </div>
        <div>
          <label>&nbsp;</label>
          <button id="convertBtn">Convert</button>
        </div>
      </div>

      <div class="row">
        <div class="muted" id="fromName">&nbsp;</div>
        <button class="swap" id="swapBtn" title="Swap">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <polyline points="17 1 21 5 17 9"></polyline>
            <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
            <polyline points="7 23 3 19 7 15"></polyline>
            <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
          </svg>
        </button>
        <div class="muted" id="toName" style="text-align:right">&nbsp;</div>
      </div>

      <div class="result" id="result">&nbsp;</div>
      <div class="err" id="error"></div>

      <div style="margin-top:16px">
        <canvas id="chart" height="120"></canvas>
      </div>

      <div class="footer">
        <span id="asof"></span>
        <span>•</span>
        <span><a href="https://www.frankfurter.app/" rel="noopener" target="_blank">Frankfurter API</a> · ECB rates</span>
        <span>•</span>
        <span><a href="https://github.com/hakanensari/frankfurter" rel="noopener" target="_blank">Source</a></span>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" integrity="sha384-uqUouqY8f2gTq/2gSgGQf5sQ8Qm8qY9tCk1V6t7I8QF0qgqpfrd2l8k4O8aFE1yF" crossorigin="anonymous"></script>
  <script>
    const $ = (id) => document.getElementById(id);
    const API = 'https://api.frankfurter.app';
    let seriesChart = null;

    const state = { currencies: {}, from: 'USD', to: 'EUR', amount: 100 };

    async function getJSON(url) {
      const res = await fetch(url, { headers: { 'Accept': 'application/json' } });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      return res.json();
    }

    function populateSelects(currencies) {
      const codes = Object.keys(currencies).sort();
      const options = codes.map(c => `<option value="${c}">${c}</option>`).join('');
      $('from').innerHTML = options;
      $('to').innerHTML = options;
      $('from').value = state.from;
      $('to').value = state.to;
      updateNames();
    }
    function updateNames() {
      $('fromName').textContent = `${state.from} — ${state.currencies[state.from] || ''}`;
      $('toName').textContent = `${state.to} — ${state.currencies[state.to] || ''}`;
    }
    function fmt(n) {
      if (isNaN(n)) return '-';
      const abs = Math.abs(n);
      const digits = abs >= 1000 ? 2 : abs >= 1 ? 4 : 6;
      return new Intl.NumberFormat(undefined, { maximumFractionDigits: digits }).format(n);
    }

    async function convert() {
      $('error').style.display = 'none';
      const amount = parseFloat($('amount').value || '0');
      if (!amount || amount < 0) { $('result').textContent = 'Enter a valid amount.'; return; }
      try {
        const data = await getJSON(`${API}/latest?amount=${amount}&from=${state.from}&to=${state.to}`);
        const rate = data.rates[state.to];
        $('result').textContent = `${fmt(amount)} ${state.from} = ${fmt(rate)} ${state.to}`;
        $('asof').textContent = `As of ${data.date}`;
        drawHistory();
      } catch (e) {
        $('error').textContent = `Conversion failed: ${e.message}`;
        $('error').style.display = 'block';
      }
    }

    async function drawHistory() {
      try {
        const end = new Date();
        const start = new Date(end);
        start.setDate(end.getDate() - 30);
        const toISO = (d) => d.toISOString().slice(0,10);
        const url = `${API}/${toISO(start)}..${toISO(end)}?from=${state.from}&to=${state.to}`;
        const data = await getJSON(url);
        const labels = Object.keys(data.rates).sort();
        const values = labels.map(d => data.rates[d][state.to]);
        const ctx = $('chart').getContext('2d');
        if (seriesChart) seriesChart.destroy();
        seriesChart = new Chart(ctx, {
          type: 'line',
          data: { labels, datasets: [{ label: `${state.from}/${state.to}`, data: values, tension: .3 }] },
          options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { x: { ticks: { maxRotation: 0, autoSkip: true } }, y: { beginAtZero: false } }
          }
        });
      } catch (e) {
        // No hard fail — keep the converter usable.
        console.warn('Chart error', e);
      }
    }

    function bind() {
      $('from').addEventListener('change', (e) => { state.from = e.target.value; updateNames(); convert(); });
      $('to').addEventListener('change',   (e) => { state.to = e.target.value; updateNames(); convert(); });
      $('amount').addEventListener('input', debounce(() => convert(), 250));
      $('swapBtn').addEventListener('click', () => { [state.from, state.to] = [state.to, state.from]; $('from').value = state.from; $('to').value = state.to; updateNames(); convert(); });
      $('convertBtn').addEventListener('click', convert);
    }

    function debounce(fn, wait) {
      let t; return (...args) => { clearTimeout(t); t = setTimeout(() => fn.apply(this, args), wait); };
    }

    (async function init(){
      try {
        const cur = await getJSON(`${API}/currencies`);
        state.currencies = cur; populateSelects(cur); bind(); convert();
      } catch (e) {
        $('error').textContent = `Failed to load currencies: ${e.message}`;
        $('error').style.display = 'block';
      }
    })();
  </script>
</body>
</html>
